# 日记便签 (DayMemo) - 思源笔记 Memos 风格插件

一个轻量级的、受 [Memos](https://github.com/usememos/memos) 启发的快速笔记插件，适用于[思源笔记](https://b3log.org/siyuan)。在思源的主内容区中快速记录想法、添加标签、搜索和过滤。

![SiYuan](https://img.shields.io/badge/思源笔记-≥3.3.0-blue) ![License](https://img.shields.io/badge/许可证-MIT-green)

## 功能特性

- **主标签页视图** — 在思源的主内容区打开（不是侧栏面板），采用 Memos 风格的双栏布局
- **快速记录** — 通过快捷键 (`Alt+Cmd+N`) 即时记录想法，无需离开当前文档
- **Markdown 支持** — 粗体、斜体、代码、链接、图片等，内联渲染
- **图片与附件上传** — 支持上传图片（按钮、粘贴、拖拽）和任意文件附件（zip、pdf 等），存储在思源 `data/assets/` 目录下，自动随云端同步
- **标签系统** — 使用 `#标签` 语法组织便签，自动提取并在侧栏标签云中显示
- **日历视图** — 真实月历，支持 `‹` `›` 翻月，「今天」按钮快速回到当月，按便签密度显示热力图着色，点击日期筛选
- **时间线视图** — 便签按日期分组，最新的在前
- **搜索** — 在侧栏中全文搜索所有便签
- **过滤标签** — 在 全部 / 已置顶 / 已归档 视图间切换
- **置顶和归档** — 将重要便签置顶，归档旧便签减少干扰
- **云同步安全** — 基于时间戳的合并逻辑，配合软删除墓碑机制，安全支持思源云端多设备同步
- **深色模式** — 自动跟随思源主题
- **多语言** — 支持中文和英文

## 界面布局

```
┌──────────────────────────────────────────────────────────┐
│  工具栏  [日记便签图标]                                    │
├──────────────────┬───────────────────────────────────────┤
│    左侧栏        │           右侧主区域                    │
│                  │                                       │
│  🔍 搜索         │  ┌─────────────────────────────────┐  │
│                  │  │  📝 便签编辑器                    │  │
│  📅 日历         │  │  [🖼 图片] [📎 附件]              │  │
│  (月视图、       │  │     Ctrl+Enter 保存              │  │
│   热力图、       │  └─────────────────────────────────┘  │
│   [今天] 按钮、  │                                       │
│   点击筛选)      │  [全部] [已置顶] [已归档]  #标签 ✕    │
│                  │                                       │
│  🏷️ 标签         │  ── 2026年2月21日 ────────────────    │
│  (标签云，       │  便签内容...          📌 📦 ✏️ 🗑      │
│   点击筛选)      │  🖼️ 图片 / 📎 附件    📌 📦 ✏️ 🗑      │
│                  │                                       │
│  📊 统计         │  ── 2026年2月20日 ────────────────    │
│  (总数、天数、   │  便签内容...          📌 📦 ✏️ 🗑      │
│   标签数)        │                                       │
└──────────────────┴───────────────────────────────────────┘
```

## 使用方法

1. 点击顶部工具栏的 **日记便签** 图标打开标签页
2. 在编辑区输入便签内容，使用 `#标签` 添加标签
3. 添加图片（点击 🖼、从剪贴板粘贴或拖拽）和文件附件（点击 📎）— 自动上传至思源 `assets/` 目录
4. 按 `Ctrl+Enter` 或点击保存
5. 使用过滤标签页（全部 / 已置顶 / 已归档）切换视图
6. 点击日历上的日期筛选该天的便签；使用 **今天** 按钮快速回到当月
7. 点击侧栏中的标签按钮按标签过滤
8. 鼠标悬停在便签上可以看到编辑 / 置顶 / 归档 / 删除操作

## 数据存储与同步

便签数据存储在 `data/storage/petal/siyuan-plugin-day-memo/memos-data.json`，该文件会自动纳入思源的云端同步。

上传的图片和附件存储在思源标准的 `data/assets/` 目录下，同样会纳入云端同步。

**多设备安全**：加载数据时，插件会执行基于时间戳的合并 — 对每条便签，保留 `updatedAt` 更新的版本。删除使用软删除（墓碑）标记，确保删除操作在多设备间正确传播。

## 开发

```bash
# 安装依赖
pnpm i

# 开发构建（监听模式）
pnpm dev

# 生产构建（生成 package.zip）
pnpm build
```

### 项目结构

```
src/
├── index.ts              # 插件入口：标签页注册、工具栏按钮、快速记录
├── types.ts              # Memo、MemoStore、FilterState 类型定义
├── store.ts              # 数据存储：增删改查、过滤、合并逻辑、持久化
├── utils.ts              # 工具函数：ID 生成、标签提取、Markdown→HTML（图片、附件、链接）、日期
├── api.ts                # 思源内核 API 封装（通知、资源上传）
├── index.scss            # 所有样式（双栏布局、日历、组件）
├── i18n/
│   ├── en_US.json        # 英文翻译
│   └── zh_CN.json        # 中文翻译
└── components/
    ├── TabPanel.ts       # 双栏布局协调器
    ├── Sidebar.ts        # 左侧栏：搜索、日历、标签、统计
    ├── Heatmap.ts        # 月历组件（导航、「今天」按钮、热力图）
    ├── MemoEditor.ts     # 编辑器（图片/附件上传、粘贴、拖拽、保存/取消）
    ├── MemoList.ts       # 时间线视图（按日期分组）
    ├── MemoItem.ts       # 单条便签卡片（操作按钮）
    ├── FilterBar.ts      # 过滤标签页 + 当前标签/日期标记
    └── TagList.ts        # 标签云（含计数）
```

## 技术栈

- **语言**：TypeScript（原生 DOM，无框架）
- **构建**：Webpack + esbuild-loader + SCSS
- **运行时**：思源插件 API（petal v1.1.7）
- **最低思源版本**：3.3.0

## 许可证

[MIT](LICENSE)
